<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç† (3/23ã€œ4/3)</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', sans-serif;
      background: #f0f4f8;
      min-height: 100vh;
      padding: 30px 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      font-size: 1.5rem;
      margin-bottom: 6px;
    }

    .subtitle {
      text-align: center;
      color: #7f8c8d;
      font-size: 0.85rem;
      margin-bottom: 24px;
    }

    .table-wrapper {
      overflow-x: auto;
      max-width: 900px;
      margin: 0 auto 28px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 620px;
    }

    thead tr th {
      background: #2c3e50;
      color: white;
      padding: 12px 10px;
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
      white-space: nowrap;
    }

    thead tr th:first-child {
      border-radius: 12px 0 0 0;
      text-align: left;
      padding-left: 20px;
    }

    thead tr th:last-child {
      border-radius: 0 12px 0 0;
    }

    .date-sub {
      display: block;
      font-size: 0.7rem;
      font-weight: 400;
      opacity: 0.75;
      margin-top: 2px;
    }

    tbody tr {
      transition: background 0.15s;
    }

    tbody tr:nth-child(even) {
      background: #f8fafc;
    }

    tbody tr:hover {
      background: #eef4fb;
    }

    td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #e8edf2;
    }

    td:first-child {
      text-align: left;
      padding-left: 20px;
      font-weight: 600;
      color: #34495e;
      font-size: 1rem;
      white-space: nowrap;
    }

    /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒœã‚¿ãƒ³åŒ– */
    .check-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .check-wrap input[type="checkbox"] {
      display: none;
    }

    .check-wrap label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 2px solid #dce3eb;
      background: #f8fafc;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.15s;
      user-select: none;
    }

    .check-wrap input:checked + label {
      background: #e74c3c;
      border-color: #c0392b;
      color: white;
    }

    .check-wrap label:hover {
      border-color: #e74c3c;
      background: #fdecea;
    }

    .check-wrap input:checked + label:hover {
      background: #c0392b;
    }

    /* é›†è¨ˆè¡Œ */
    .summary-row td {
      background: #ecf0f1;
      font-weight: 700;
      font-size: 0.85rem;
      color: #2c3e50;
      border-top: 2px solid #bdc3c7;
    }

    .summary-row td:first-child {
      color: #2c3e50;
    }

    .count-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
    }

    .count-0  { background: #d5f5e3; color: #1e8449; }
    .count-1  { background: #fef9e7; color: #b7950b; }
    .count-2  { background: #fdebd0; color: #d35400; }
    .count-3  { background: #fce0e0; color: #c0392b; }
    .count-4  { background: #c0392b; color: white; }

    /* çµæœãƒ‘ãƒãƒ« */
    .result-panel {
      max-width: 900px;
      margin: 0 auto 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      padding: 20px 24px;
    }

    .result-panel h2 {
      font-size: 1rem;
      color: #2c3e50;
      margin-bottom: 14px;
      border-bottom: 2px solid #ecf0f1;
      padding-bottom: 8px;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
    }

    .result-card {
      border-radius: 8px;
      padding: 10px 14px;
      border-left: 4px solid;
    }

    .result-card.ok    { border-color: #27ae60; background: #eafaf1; }
    .result-card.warn  { border-color: #e67e22; background: #fef5e7; }
    .result-card.busy  { border-color: #e74c3c; background: #fdedec; }

    .result-card .person-name {
      font-size: 0.95rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 4px;
    }

    .result-card .dates {
      font-size: 0.75rem;
      color: #555;
      line-height: 1.6;
    }

    .result-card .no-ng {
      font-size: 0.75rem;
      color: #27ae60;
    }

    .available-dates {
      margin-top: 20px;
      padding-top: 14px;
      border-top: 2px solid #ecf0f1;
    }

    .available-dates h3 {
      font-size: 0.9rem;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .avail-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .avail-chip {
      padding: 5px 14px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .avail-chip.all  { background: #d5f5e3; color: #1a6e35; }
    .avail-chip.some { background: #fdebd0; color: #935116; }
    .avail-chip.none { background: #fdedec; color: #922b21; }

    /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ */
    .toolbar {
      display: flex;
      justify-content: center;
      gap: 10px;
      max-width: 900px;
      margin: 0 auto 20px;
      flex-wrap: wrap;
    }

    .toolbar-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 9px 20px;
      border-radius: 8px;
      border: none;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }

    .toolbar-btn:active { transform: scale(0.97); }

    .btn-export {
      background: #2980b9;
      color: white;
    }
    .btn-export:hover { background: #2471a3; }

    .btn-import {
      background: #27ae60;
      color: white;
    }
    .btn-import:hover { background: #1e8449; }

    .reset-btn {
      display: block;
      margin: 0 auto;
      padding: 10px 30px;
      background: #7f8c8d;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.15s;
    }

    .reset-btn:hover { background: #5d6d7e; }

    /* ä¿å­˜ãƒˆãƒ¼ã‚¹ãƒˆ */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: #2c3e50;
      color: white;
      padding: 10px 24px;
      border-radius: 24px;
      font-size: 0.9rem;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s, transform 0.2s;
      z-index: 999;
      white-space: nowrap;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ç¢ºèªãƒœã‚¿ãƒ³ */
    .confirm-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .confirm-btn {
      padding: 5px 10px;
      border-radius: 20px;
      border: 2px solid #bdc3c7;
      background: #f0f4f8;
      color: #95a5a6;
      font-size: 0.75rem;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.15s;
      user-select: none;
    }

    .confirm-btn:hover {
      border-color: #27ae60;
      color: #27ae60;
      background: #eafaf1;
    }

    .confirm-btn.confirmed {
      border-color: #27ae60;
      background: #27ae60;
      color: white;
    }

    .confirm-btn.confirmed:hover {
      background: #1e8449;
      border-color: #1e8449;
    }

    thead tr th.confirm-col {
      min-width: 70px;
    }

    /* åŒæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
    .sync-status {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 0.75rem;
      font-weight: 600;
      z-index: 998;
      transition: opacity 0.3s;
    }
    .sync-status.synced  { background: #d5f5e3; color: #1e8449; }
    .sync-status.syncing { background: #fef9e7; color: #b7950b; }
    .sync-status.error   { background: #fce0e0; color: #c0392b; }
  </style>
</head>
<body>

<h1>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</h1>
<p class="subtitle">2026å¹´3æœˆ23æ—¥ï¼ˆæœˆï¼‰ã€œ 4æœˆ3æ—¥ï¼ˆé‡‘ï¼‰ã€€å¹³æ—¥ã®ã¿ã€€|ã€€Ã—ï¼éƒ½åˆãŒæ‚ªã„æ—¥</p>

<div class="toolbar">
  <button class="toolbar-btn btn-export" onclick="exportData()">ğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
  <button class="toolbar-btn btn-import" onclick="document.getElementById('importInput').click()">ğŸ“¤ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
  <input type="file" id="importInput" accept=".json" style="display:none" onchange="importData(event)">
</div>

<div class="table-wrapper">
  <table id="scheduleTable">
    <thead>
      <tr id="headerRow">
        <th>åå‰</th>
        <!-- æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ã¯JSã§æŒ¿å…¥ -->
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- è¡Œã¯JSã§æŒ¿å…¥ -->
    </tbody>
    <tfoot>
      <tr class="summary-row" id="summaryRow">
        <td>NGäººæ•°</td>
      </tr>
    </tfoot>
  </table>
</div>

<div class="result-panel">
  <h2>å€‹äººåˆ¥ NGæ—¥ã¾ã¨ã‚</h2>
  <div class="result-grid" id="personResults"></div>

  <div class="available-dates">
    <h3>å…¨å“¡OKã®æ—¥ / å‚åŠ å¯èƒ½äººæ•°</h3>
    <div class="avail-list" id="availList"></div>
  </div>
</div>

<button class="reset-btn" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
<div class="toast" id="toast"></div>
<div class="sync-status" id="syncStatus"></div>

<script>
  // ===== è¨­å®š =====
  const MEMBERS = ['ä¸­ç”°ã•ã‚“', 'ç”°æ‘ã•ã‚“', 'æ —åŸã•ã‚“', 'ç•¦åœ°ã•ã‚“'];
  const DOW = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];

  // 2026/3/23ã€œ4/3 ã®å¹³æ—¥ã‚’ç”Ÿæˆ
  function getWeekdays(startY, startM, startD, endY, endM, endD) {
    const days = [];
    let cur = new Date(startY, startM - 1, startD);
    const end = new Date(endY, endM - 1, endD);
    while (cur <= end) {
      const dow = cur.getDay();
      if (dow !== 0 && dow !== 6) {
        days.push({
          y: cur.getFullYear(),
          m: cur.getMonth() + 1,
          d: cur.getDate(),
          dow: DOW[dow],
          label: `${cur.getMonth()+1}/${cur.getDate()}`,
          key: `${cur.getFullYear()}-${String(cur.getMonth()+1).padStart(2,'0')}-${String(cur.getDate()).padStart(2,'0')}`
        });
      }
      cur.setDate(cur.getDate() + 1);
    }
    return days;
  }

  const DAYS = getWeekdays(2026,3,23, 2026,4,3);

  // ===== çŠ¶æ…‹ =====
  // state[memberName][dayKey] = true/false
  let state = {};
  MEMBERS.forEach(m => {
    state[m] = {};
    DAYS.forEach(d => { state[m][d.key] = false; });
  });

  // confirmed[memberName] = true/false
  let confirmed = {};
  MEMBERS.forEach(m => { confirmed[m] = false; });

  // ===== ä¿å­˜ãƒ»å¾©å…ƒ =====
  const STORAGE_KEY = 'schedule_2026_0323';

  let toastTimer = null;
  function showToast(msg) {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => el.classList.remove('show'), 2000);
  }

  // --- åŒæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ---
  function updateSyncStatus(status) {
    const el = document.getElementById('syncStatus');
    el.className = 'sync-status ' + status;
    const messages = { synced: 'âœ“ åŒæœŸæ¸ˆã¿', syncing: 'â†» åŒæœŸä¸­...', error: 'âš  åŒæœŸã‚¨ãƒ©ãƒ¼' };
    el.textContent = messages[status] || '';
  }

  // --- ã‚µãƒ¼ãƒãƒ¼ä¿å­˜ (ãƒ‡ãƒã‚¦ãƒ³ã‚¹) ---
  let saveTimer = null;
  function saveToServer(data) {
    clearTimeout(saveTimer);
    saveTimer = setTimeout(async () => {
      updateSyncStatus('syncing');
      try {
        const res = await fetch('/api/schedule', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!res.ok) throw new Error('Server error');
        const result = await res.json();
        if (result.success) {
          updateSyncStatus('synced');
        } else {
          throw new Error(result.error || 'Save failed');
        }
      } catch (e) {
        console.error('Save to server failed:', e);
        updateSyncStatus('error');
      }
    }, 500);
  }

  function saveState() {
    const data = { ng: state, confirmed };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    saveToServer(data);
  }

  // --- ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰èª­ã¿è¾¼ã¿ ---
  async function loadFromServer() {
    try {
      updateSyncStatus('syncing');
      const res = await fetch('/api/schedule');
      if (!res.ok) throw new Error('Server error');
      const result = await res.json();
      if (result.success && result.data) {
        applyData(result.data);
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ ng: state, confirmed }));
        updateSyncStatus('synced');
        return true;
      }
      updateSyncStatus('synced');
      return false;
    } catch (e) {
      console.error('Failed to load from server:', e);
      updateSyncStatus('error');
      return false;
    }
  }

  // --- ãƒ‡ãƒ¼ã‚¿é©ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
  function applyData(parsed) {
    const ng = parsed.ng || parsed;
    MEMBERS.forEach(m => {
      if (ng[m]) {
        DAYS.forEach(d => { state[m][d.key] = !!ng[m][d.key]; });
      }
      if (parsed.confirmed) {
        confirmed[m] = !!parsed.confirmed[m];
      }
    });
  }

  // --- UIå†æç”»ãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
  function refreshUI() {
    MEMBERS.forEach(member => {
      DAYS.forEach(day => {
        const cb = document.getElementById(`chk_${member}_${day.key}`);
        if (cb) cb.checked = state[member][day.key];
      });
      const btn = document.querySelector(`.confirm-btn[data-member="${member}"]`);
      if (btn) {
        btn.textContent = confirmed[member] ? 'ç¢ºèªæ¸ˆ' : 'æœªç¢ºèª';
        btn.classList.toggle('confirmed', confirmed[member]);
      }
    });
    updateSummary();
  }

  function loadState() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) return;
    try { applyData(JSON.parse(saved)); } catch(e) {}
  }

  // ===== ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹ç¯‰ =====
  function buildTable() {
    // ãƒ˜ãƒƒãƒ€ãƒ¼
    const headerRow = document.getElementById('headerRow');
    const confirmTh = document.createElement('th');
    confirmTh.textContent = 'ç¢ºèª';
    confirmTh.className = 'confirm-col';
    headerRow.appendChild(confirmTh);
    DAYS.forEach(d => {
      const th = document.createElement('th');
      th.innerHTML = `${d.label}<span class="date-sub">${d.dow}</span>`;
      headerRow.appendChild(th);
    });

    // è¡Œ
    const tbody = document.getElementById('tableBody');
    MEMBERS.forEach(member => {
      const tr = document.createElement('tr');
      const nameTd = document.createElement('td');
      nameTd.textContent = member;
      tr.appendChild(nameTd);

      // ç¢ºèªãƒœã‚¿ãƒ³
      const confirmTd = document.createElement('td');
      const confirmWrap = document.createElement('div');
      confirmWrap.className = 'confirm-wrap';
      const btn = document.createElement('button');
      btn.className = 'confirm-btn' + (confirmed[member] ? ' confirmed' : '');
      btn.textContent = confirmed[member] ? 'ç¢ºèªæ¸ˆ' : 'æœªç¢ºèª';
      btn.dataset.member = member;
      btn.addEventListener('click', () => {
        confirmed[member] = !confirmed[member];
        btn.textContent = confirmed[member] ? 'ç¢ºèªæ¸ˆ' : 'æœªç¢ºèª';
        btn.classList.toggle('confirmed', confirmed[member]);
        saveState();
        updateSummary();
        showToast(confirmed[member] ? `${member}ã‚’ç¢ºèªæ¸ˆã«ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ` : `${member}ã‚’æœªç¢ºèªã«æˆ»ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ`);
      });
      confirmWrap.appendChild(btn);
      confirmTd.appendChild(confirmWrap);
      tr.appendChild(confirmTd);

      DAYS.forEach(day => {
        const td = document.createElement('td');
        const wrap = document.createElement('div');
        wrap.className = 'check-wrap';

        const id = `chk_${member}_${day.key}`;
        const input = document.createElement('input');
        input.type = 'checkbox';
        input.id = id;
        input.checked = state[member][day.key];

        const label = document.createElement('label');
        label.htmlFor = id;
        label.textContent = 'Ã—';
        label.title = `${member} ${day.label}(${day.dow}) ã‚’NG`;

        input.addEventListener('change', () => {
          state[member][day.key] = input.checked;
          saveState();
          updateSummary();
        });

        wrap.appendChild(input);
        wrap.appendChild(label);
        td.appendChild(wrap);
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });

    // é›†è¨ˆè¡Œï¼ˆç¢ºèªåˆ— + æ—¥ä»˜åˆ—ï¼‰
    const summaryRow = document.getElementById('summaryRow');
    summaryRow.appendChild(document.createElement('td')); // ç¢ºèªåˆ—ã®ç©ºã‚»ãƒ«
    DAYS.forEach(() => {
      summaryRow.appendChild(document.createElement('td'));
    });
  }

  // ===== é›†è¨ˆæ›´æ–° =====
  function updateSummary() {
    // ãƒ•ãƒƒã‚¿ãƒ¼ã®NGäººæ•°ï¼ˆcells[0]=NGäººæ•°ãƒ©ãƒ™ãƒ«, cells[1]=ç¢ºèªåˆ—ç©º, cells[2]ã€œ=æ—¥ä»˜åˆ—ï¼‰
    const summaryRow = document.getElementById('summaryRow');
    const cells = summaryRow.querySelectorAll('td');
    DAYS.forEach((day, i) => {
      const count = MEMBERS.filter(m => state[m][day.key]).length;
      const badge = document.createElement('span');
      badge.className = `count-badge count-${count}`;
      badge.textContent = `${count}äºº`;
      cells[i + 2].innerHTML = '';
      cells[i + 2].appendChild(badge);
    });

    // å€‹äººåˆ¥çµæœ
    const personResults = document.getElementById('personResults');
    personResults.innerHTML = '';
    MEMBERS.forEach(member => {
      const ngDays = DAYS.filter(d => state[member][d.key]);
      const card = document.createElement('div');
      const isConfirmed = confirmed[member];
      const cls = ngDays.length === 0 ? 'ok' : ngDays.length <= 2 ? 'warn' : 'busy';
      card.className = `result-card ${cls}`;
      const confirmLabel = isConfirmed
        ? '<span style="font-size:0.7rem;background:#27ae60;color:white;padding:1px 7px;border-radius:10px;margin-left:6px;">ç¢ºèªæ¸ˆ</span>'
        : '<span style="font-size:0.7rem;background:#bdc3c7;color:white;padding:1px 7px;border-radius:10px;margin-left:6px;">æœªç¢ºèª</span>';
      card.innerHTML = `<div class="person-name">${member}${confirmLabel}</div>`;
      if (ngDays.length === 0) {
        card.innerHTML += `<div class="no-ng">å…¨æ—¥ç¨‹OK</div>`;
      } else {
        card.innerHTML += `<div class="dates">${ngDays.map(d=>`${d.label}(${d.dow})`).join('<br>')}</div>`;
      }
      personResults.appendChild(card);
    });

    // å…¨å“¡OKã®æ—¥
    const availList = document.getElementById('availList');
    availList.innerHTML = '';
    DAYS.forEach(day => {
      const ngCount = MEMBERS.filter(m => state[m][day.key]).length;
      const chip = document.createElement('div');
      const cls = ngCount === 0 ? 'all' : ngCount < MEMBERS.length ? 'some' : 'none';
      chip.className = `avail-chip ${cls}`;
      const okCount = MEMBERS.length - ngCount;
      const label = ngCount === 0
        ? `${day.label}(${day.dow}) å…¨å“¡OK`
        : ngCount === MEMBERS.length
          ? `${day.label}(${day.dow}) å…¨å“¡NG`
          : `${day.label}(${day.dow}) ${okCount}äººOK`;
      chip.textContent = label;
      availList.appendChild(chip);
    });
  }

  // ===== ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ =====
  function exportData() {
    const data = { ng: state, confirmed, exportedAt: new Date().toISOString() };
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `schedule_2026_0323_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
    showToast('ğŸ“¥ ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
  }

  // ===== ã‚¤ãƒ³ãƒãƒ¼ãƒˆ =====
  function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const parsed = JSON.parse(e.target.result);
        const ng = parsed.ng || parsed;
        MEMBERS.forEach(m => {
          if (ng[m]) {
            DAYS.forEach(d => { state[m][d.key] = !!ng[m][d.key]; });
          }
          if (parsed.confirmed) {
            confirmed[m] = !!parsed.confirmed[m];
          }
        });
        refreshUI();
        saveState();
        showToast('ğŸ“¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
      } catch {
        showToast('âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
      event.target.value = '';
    };
    reader.readAsText(file);
  }

  function resetAll() {
    if (!confirm('å…¨ã¦ã®ãƒã‚§ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) return;
    MEMBERS.forEach(m => {
      DAYS.forEach(d => { state[m][d.key] = false; });
      confirmed[m] = false;
    });
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => { cb.checked = false; });
    document.querySelectorAll('.confirm-btn').forEach(btn => {
      btn.textContent = 'æœªç¢ºèª';
      btn.classList.remove('confirmed');
    });
    saveState();
    updateSummary();
  }

  // ===== åˆæœŸåŒ– =====
  loadState();
  buildTable();
  updateSummary();

  // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§UIã‚’æ›´æ–°
  loadFromServer().then(loaded => {
    if (loaded) refreshUI();
  });
</script>
</body>
</html>
